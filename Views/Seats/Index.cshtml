@model IEnumerable<CinemaWeb.Models.Seat>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var customer = Session["Customer"];
}

<!DOCTYPE html>
<html>
<head>
    <title>Chọn ghế xem phim</title>
    <style>
    </style>
</head>
<body>
    <div class="screen">
        <h1 style="margin-top:20px">SCREEN</h1>
    </div>
    <div id="seat-container">
        @foreach (var item in Model)
        {
            <div class="seat-row">
                @for (int seatNum = 1; seatNum <= item.quality; seatNum++)
                {
                    var seatName = item.name + seatNum;
                    var seatType = item.type;
                    var seatPrice = item.price;
                    <div class="seat" data-seat-name="@seatName" data-seat-type="@seatType" data-seat-price="@seatPrice">
                        @seatName
                    </div>
                }
            </div>
        }
    </div>
    <div id="cart">
        <h2>Giỏ hàng</h2>
        <div id="cart-total">
            <div>Số ghế: <span id="seat-count">0</span></div>
            <div>Loại ghế: <span id="seat-type">N/A</span></div>
            <div>Giá vé: $<span id="seat-price">0</span></div>
            <div>Tên phim: <span id="movie-name">Người</span></div>
            <div>Thời gian: <span id="movie-time">120 phút</span></div>
            <div>Ghế đã chọn: <span id="selected-seats">N/A</span></div>
        </div>
        <div id="login-notice" style="display: none;">
            <p style="color: black" >Vui lòng đăng nhập để đặt vé.</p>
        </div>
        <button id="checkout-btn" onclick="checkLoginAndCheckout()">Đặt vé</button>
    </div>

    <script>
        const seatsContainer = document.getElementById('seat-container');
        const cartTotalElement = document.getElementById('cart-total');
        const seatCountElement = document.getElementById('seat-count');
        const seatTypeElement = document.getElementById('seat-type');
        const seatPriceElement = document.getElementById('seat-price');
        const movieNameElement = document.getElementById('movie-name');
        const movieTimeElement = document.getElementById('movie-time');
        const selectedSeatsElement = document.getElementById('selected-seats');
        const loginNotice = document.getElementById('login-notice');

        let selectedSeats = [];

        function selectSeat(event) {
            const seat = event.target;
            if (seat.classList.contains('seat')) {
                const seatName = seat.getAttribute('data-seat-name');

                if (seat.classList.contains('selected')) {
                    seat.classList.remove('selected');
                    const index = selectedSeats.findIndex(seat => seat.seatName === seatName);
                    if (index > -1) {
                        selectedSeats.splice(index, 1);
                    }
                } else {
                    if (selectedSeats.length < 8) {
                        seat.classList.add('selected');
                        const seatType = seat.getAttribute('data-seat-type');
                        const seatPrice = parseFloat(seat.getAttribute('data-seat-price'));
                        selectedSeats.push({ seatName, seatType, seatPrice });
                    } else {
                        alert('Bạn không thể chọn nhiều hơn 8 ghế một lúc!');
                    }
                }

                updateCart();
            }
        }

        function updateCart() {
            const total = selectedSeats.reduce((sum, seat) => sum + seat.seatPrice, 0);
            seatCountElement.textContent = selectedSeats.length;
            seatTypeElement.textContent = selectedSeats.length > 0
                ? selectedSeats.map(seat => (seat.seatType === '0' ? 'Thường' : 'VIP')).join(', ')
                : 'N/A';
            seatPriceElement.textContent = total;
            selectedSeatsElement.textContent = selectedSeats.map(seat => seat.seatName).join(', ');
        }

        function checkLoginAndCheckout() {
            const customer = @Html.Raw(Json.Encode(Session["Customer"]));

            if (customer == null) {
                // Chưa đăng nhập, hiển thị thông báo yêu cầu đăng nhập
                loginNotice.style.display = 'block';
            } else {
                // Đã đăng nhập, thực hiện đặt vé
                performCheckout();
            }
        }

        function performCheckout() {
            // Thực hiện đặt vé, ví dụ: gửi dữ liệu đặt vé đến máy chủ
            alert('Bạn đã đặt vé thành công!');
        }

        seatsContainer.addEventListener('click', selectSeat);
    </script>
</body>
</html>
